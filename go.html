<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة الخبير حمدي عيد | تسجيل الدخول</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #27ae60; /* لون حيوي يرمز للأحياء */
            --bg-color: #1a1a2e;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-color);
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); /* نقش بسيط */
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 450px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .logo { width: 100px; margin-bottom: 10px; }
        h2 { color: var(--accent-color); margin-bottom: 25px; }

        input, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            outline: none;
            transition: 0.3s;
        }

        input:focus { background: rgba(255,255,255,0.2); border: 1px solid var(--accent-color); }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: var(--accent-color);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            margin-top: 15px;
            transition: 0.3s;
        }

        button:hover { transform: scale(1.02); filter: brightness(1.2); }

        .switch-form { margin-top: 15px; font-size: 14px; cursor: pointer; color: #aaa; }
        .switch-form span { color: var(--accent-color); text-decoration: underline; }

        /* Modal Style */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #2c3e50;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
            border: 2px solid var(--accent-color);
        }
        .verify-code {
            display: block;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 5px;
            margin: 15px 0;
            color: var(--accent-color);
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="mainBox">
    <img src="H.png" alt="Logo" class="logo">
    <h2 id="formTitle">عالم الأحياء: حمدي عيد</h2>

    <div id="loginForm">
        <input type="tel" id="loginPhone" placeholder="رقم الهاتف" oninput="checkMaster(this.value)">
        <div id="masterSection" class="hidden">
            <p style="color: #f1c40f;">مرحباً قائد المنصة، مستر حمدي عيد</p>
        </div>
        <input type="password" id="loginPass" placeholder="كلمة السر">
        <button onclick="handleLogin()">تسجيل الدخول</button>
        <p class="switch-form" onclick="toggleForm()">ليس لديك حساب؟ <span>إنشاء حساب جديد</span></p>
    </div>

    <div id="signupForm" class="hidden">
        <input type="text" id="userName" placeholder="الاسم ثلاثي">
        <select id="userGrade">
            <option value="">اختر المرحلة الدراسية</option>
            <option value="1">الصف الأول الثانوي</option>
            <option value="2">الصف الثاني الثانوي</option>
            <option value="3">الصف الثالث الثانوي</option>
        </select>
        <input type="text" id="userCity" placeholder="المدينة">
        <input type="tel" id="userPhone" placeholder="رقم الهاتف">
        <button onclick="showVerifyModal()">تحقق</button>
        <p class="switch-form" onclick="toggleForm()">لديك حساب بالفعل؟ <span>تسجيل دخول</span></p>
    </div>
</div>

<div class="modal" id="verifyModal">
    <div class="modal-content">
        <p>أهلاً بك في رحلة عالم الأحياء!<br>كود التفعيل الخاص بك من المستر حمدي عيد هو:</p>
        <span class="verify-code" id="generatedCode">5521</span>
        <button onclick="copyCode()">نسخ الكود</button>
        <button style="background: #7f8c8d; margin-top: 5px;" onclick="closeModal()">تم النسخ، تعيين كلمة السر</button>
    </div>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCcFRLMsewcgYXYgVvdkyQHf-imoJHHzng",
        authDomain: "mrhamdy-1c406.firebaseapp.com",
        projectId: "mrhamdy-1c406",
        storageBucket: "mrhamdy-1c406.firebasestorage.app",
        databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
        messagingSenderId: "806268398144",
        appId: "1:806268398144:web:c40aef6b378377f72b4da5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const MASTER_PHONE = "01111276700";

    // 1. التوجيه التلقائي (Security Check)
    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            db.collection("users").doc(user.uid).get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    if (data.status === "blocked") {
                        window.location.href = "contact.html";
                    } else {
                        window.location.href = "index.html";
                    }
                }
            });
        }
    });

    function toggleForm() {
        document.getElementById('loginForm').classList.toggle('hidden');
        document.getElementById('signupForm').classList.toggle('hidden');
        document.getElementById('formTitle').innerText = 
            document.getElementById('signupForm').classList.contains('hidden') ? "عالم الأحياء: حمدي عيد" : "انضم لرحلة العلم";
    }

    function checkMaster(val) {
        if (val === MASTER_PHONE) {
            document.getElementById('masterSection').classList.remove('hidden');
        } else {
            document.getElementById('masterSection').classList.add('hidden');
        }
    }

    function showVerifyModal() {
        const code = Math.floor(1000 + Math.random() * 9000);
        document.getElementById('generatedCode').innerText = code;
        document.getElementById('verifyModal').style.display = 'flex';
    }

    function copyCode() {
        const code = document.getElementById('generatedCode').innerText;
        navigator.clipboard.writeText(code);
        alert("تم نسخ كود التحقق بنجاح");
    }

    function closeModal() {
        document.getElementById('verifyModal').style.display = 'none';
        // هنا يتم تحويل الواجهة لطلب كلمة السر فقط لإكمال التسجيل في Firebase
        alert("الآن قم بكتابة كلمة السر لإتمام التسجيل");
    }

    function handleLogin() {
        // منطق تسجيل الدخول بـ Firebase Auth
        // يتم هنا فحص الرقم وكلمة السر
        alert("جاري التحقق من البيانات...");
    }
</script>

</body>
</html>
