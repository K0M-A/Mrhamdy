<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة خبير الأحياء | حمدي عيد</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #22c55e; --bg: #050810; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .hidden { display: none; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 100; }
        .modal-box { background: #1e293b; padding: 25px; border-radius: 15px; border: 1px solid var(--primary); max-width: 300px; }
    </style>
</head>
<body>

<div class="container">
    <img src="H.png" width="80" alt="Logo">
    <h2 id="formTitle">عالم الأحياء: حمدي عيد</h2>

    <div id="loginSection">
        <input type="tel" id="logPhone" placeholder="رقم الهاتف" oninput="checkIfMaster(this.value)">
        <div id="masterWelcome" class="hidden" style="color: #f1c40f; margin-bottom: 10px;">مرحباً قائد المنصة، مستر حمدي عيد</div>
        <input type="password" id="logPass" placeholder="كلمة السر">
        <button onclick="login()">دخول</button>
        <p onclick="toggleForm()" style="cursor:pointer; font-size: 14px; margin-top: 15px;">جديد؟ <span style="color:var(--primary)">إنشاء حساب جديد</span></p>
    </div>

    <div id="signupSection" class="hidden">
        <input type="text" id="regName" placeholder="الاسم ثلاثي">
        <select id="regGrade">
            <option value="1">الصف الأول الثانوي</option>
            <option value="2">الصف الثاني الثانوي</option>
            <option value="3">الصف الثالث الثانوي</option>
        </select>
        <input type="text" id="regCity" placeholder="المدينة">
        <input type="tel" id="regPhone" placeholder="رقم الهاتف">
        <button onclick="startVerification()">تحقق وإنشاء الحساب</button>
        <p onclick="toggleForm()" style="cursor:pointer; font-size: 14px; margin-top: 15px;">عندك حساب؟ <span style="color:var(--primary)">تسجيل دخول</span></p>
    </div>
</div>

<div class="modal" id="vModal">
    <div class="modal-box">
        <p>كود التفعيل الخاص بك من المستر:</p>
        <h2 id="vCode" style="color:var(--primary); letter-spacing: 5px;"></h2>
        <button onclick="copyAndContinue()">نسخ الكود وتعيين كلمة السر</button>
    </div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyCcFRLMsewcgYXYgVvdkyQHf-imoJHHzng",
        authDomain: "mrhamdy-1c406.firebaseapp.com",
        projectId: "mrhamdy-1c406",
        storageBucket: "mrhamdy-1c406.firebasestorage.app",
        databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
        messagingSenderId: "806268398144",
        appId: "1:806268398144:web:c40aef6b378377f72b4da5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    function toggleForm() {
        document.getElementById('loginSection').classList.toggle('hidden');
        document.getElementById('signupSection').classList.toggle('hidden');
    }

    function checkIfMaster(val) {
        if (val === "01111276700") {
            document.getElementById('masterWelcome').classList.remove('hidden');
        } else {
            document.getElementById('masterWelcome').classList.add('hidden');
        }
    }

    // إنشاء حساب جديد
    let tempUserData = {};
    function startVerification() {
        tempUserData = {
            name: document.getElementById('regName').value,
            grade: document.getElementById('regGrade').value,
            city: document.getElementById('regCity').value,
            phone: document.getElementById('regPhone').value
        };

        if(!tempUserData.name || !tempUserData.phone) return alert("اكمل البيانات");
        
        const code = Math.floor(1000 + Math.random() * 9000);
        document.getElementById('vCode').innerText = code;
        document.getElementById('vModal').style.display = 'flex';
    }

    async function copyAndContinue() {
        const pass = prompt("قم بتعيين كلمة سر لحسابك:");
        if(!pass || pass.length < 6) return alert("كلمة السر يجب أن تكون 6 أرقام أو حروف");

        try {
            // استخدام الهاتف كإيميل وهمي لـ Firebase Auth
            const email = tempUserData.phone + "@mrhamdy.com";
            const userCredential = await auth.createUserWithEmailAndPassword(email, pass);
            
            await db.collection("users").doc(userCredential.user.uid).set({
                name: tempUserData.name,
                phone: tempUserData.phone,
                grade: tempUserData.grade,
                city: tempUserData.city,
                role: (tempUserData.phone === "01111276700") ? "admin" : "student",
                status: "active",
                balance: 0,
                ownedCourses: []
            });

            alert("تم إنشاء الحساب بنجاح!");
            window.location.href = "index.html";
        } catch (error) {
            alert("خطأ: " + error.message);
        }
    }

    async function login() {
        const phone = document.getElementById('logPhone').value;
        const pass = document.getElementById('logPass').value;
        const email = phone + "@mrhamdy.com";

        try {
            await auth.signInWithEmailAndPassword(email, pass);
            window.location.href = "index.html";
        } catch (error) {
            alert("رقم الهاتف أو كلمة السر خطأ");
        }
    }
</script>
</body>
</html>
