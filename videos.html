<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ù…Ø³ØªØ± Ø­Ù…Ø¯ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --main: #00e5ff; --bg: #05080f; --card: #111b27; --danger: #ff1744; }
        * { box-sizing: border-box; -webkit-user-select: none; user-select: none; }
        body { background: var(--bg); color: white; font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 50px; }
        
        .header { background: var(--card); padding: 15px; text-align: center; border-bottom: 2px solid var(--main); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .container { padding: 15px; max-width: 900px; margin: auto; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø³ØªØ± */
        .admin-panel { background: var(--card); border: 2px dashed var(--main); padding: 20px; border-radius: 15px; margin-bottom: 20px; display: none; }
        .admin-panel h3 { margin-top: 0; color: var(--main); }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; background: #0a121e; color: white; font-family: 'Cairo'; }

        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
        .video-box { position: relative; width: 100%; background: #000; border-radius: 15px; overflow: hidden; border: 1px solid #222; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; display: block; z-index: 1; }
        
        .secure-wm {
            position: absolute; z-index: 9999; color: rgba(255, 255, 255, 0.5);
            font-size: 16px; font-weight: 900; pointer-events: none;
            background: rgba(0,0,0,0.3); padding: 4px 10px; border-radius: 5px;
            text-shadow: 2px 2px 4px #000; white-space: nowrap; transition: 0.5s;
        }

        /* Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© ØªÙ…Ù†Ø¹ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ÙÙŠØ¯ÙŠÙˆ */
        .guard-overlay { position: absolute; inset: 0; z-index: 1000; background: rgba(0,0,0,0); }

        .btn { background: var(--main); color: #000; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-family: 'Cairo'; transition: 0.3s; }
        .btn:active { transform: scale(0.95); }
        
        .course-card { background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 4px solid var(--main); }
        .active-info { background: var(--card); padding: 15px; border-radius: 0 0 15px 15px; margin-bottom: 20px; border: 1px solid #222; border-top: none; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="header">
        <h2 style="margin:0; color:var(--main)">ğŸ’ Ù…Ù†ØµØ© Ù…Ø³ØªØ± Ø­Ù…Ø¯ÙŠ</h2>
    </div>

    <div class="container">
        <div id="admin-area" class="admin-panel">
            <h3><i class="fas fa-shield-alt"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© (GitHub)</h3>
            <input type="text" id="c-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©">
            <input type="text" id="c-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ GitHub">
            <input type="text" id="c-repo" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Repository)">
            <input type="text" id="c-tag" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± (Tag) - Ù…Ø«Ø§Ù„: v1.0">
            <input type="text" id="c-desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©">
            <button class="btn" onclick="addNewCourse()">Ø±ÙØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø¢Ù†</button>
        </div>

        <div id="active-video-area" style="display:none;">
            <div class="video-box">
                <div class="guard-overlay"></div>
                <div id="wm-text" class="secure-wm">IDENTIFYING...</div>
                <video id="main-player" controls controlsList="nodownload" oncontextmenu="return false;"></video>
            </div>
            <div class="active-info">
                <h3 id="display-title" style="margin:0; color:var(--main)"></h3>
                <p id="display-desc" style="color:#aaa; font-size:0.9rem; margin: 10px 0 0 0;"></p>
            </div>
        </div>

        <div id="courses-list-container">
            <h4 style="margin-bottom: 15px;"><i class="fas fa-book-open"></i> Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h4>
            <div id="courses-list"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "Ø¶Ø¹_Ù‡Ù†Ø§_API_KEY",
            authDomain: "mrhamdy-1c406.firebaseapp.com",
            databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
            projectId: "mrhamdy-1c406",
            storageBucket: "mrhamdy-1c406.appspot.com",
            messagingSenderId: "806268398144",
            appId: "1:806268398144:web:e7c9b87205cbb6fb2b4da5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const userPhone = localStorage.getItem('userLoggedIn');
        let userData = null;

        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¸Ø±
        if (!userPhone) {
            window.location.href = "index.html";
        }

        db.ref('students/' + userPhone).on('value', snap => {
            userData = snap.val();
            if (!userData) { window.location.href = "index.html"; return; }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¸ÙˆØ±Ø§Ù‹
            if (userData.status === 'blocked') {
                window.location.href = "contact.html";
                return;
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ±
            if (userData.role === 'admin') {
                document.getElementById('admin-area').style.display = 'block';
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
            document.getElementById('wm-text').innerText = `${userData.name} | ${userPhone}`;
        });

        // 3. Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯ (Ù„Ù„Ù…Ø³ØªØ±)
        function addNewCourse() {
            const title = document.getElementById('c-title').value;
            const user = document.getElementById('c-user').value;
            const repo = document.getElementById('c-repo').value;
            const tag = document.getElementById('c-tag').value;
            const desc = document.getElementById('c-desc').value;

            if (!title || !user || !repo || !tag) return alert("Ø¨Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

            // Ø±Ø§Ø¨Ø· Ø¬ÙŠØª Ù‡Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ù„Ù attachment.mp4
            const finalUrl = `https://github.com/${user}/${repo}/releases/download/${tag}/attachment.mp4`;

            db.ref('all_courses').push({
                title: title,
                url: finalUrl,
                desc: desc,
                time: Date.now()
            }).then(() => {
                alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload();
            });
        }

        // 4. ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª
        db.ref('all_courses').on('value', snap => {
            const list = document.getElementById('courses-list');
            list.innerHTML = '';
            snap.forEach(child => {
                const c = child.val();
                list.innerHTML += `
                    <div class="course-card">
                        <div>
                            <div style="font-weight:bold">${c.title}</div>
                            <div style="font-size:0.8rem; color:#888">${c.desc || ''}</div>
                        </div>
                        <button class="btn" style="width:auto; padding:8px 15px" onclick="playVideo('${c.url}', '${c.title}', '${c.desc}')">
                            <i class="fas fa-play"></i> ÙØªØ­
                        </button>
                    </div>
                `;
            });
        });

        function playVideo(url, title, desc) {
            document.getElementById('active-video-area').style.display = 'block';
            const player = document.getElementById('main-player');
            player.src = url;
            document.getElementById('display-title').innerText = title;
            document.getElementById('display-desc').innerText = desc;
            player.play().catch(() => alert("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Public ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù„Ù attachment.mp4"));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 5. Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ® (Ø§Ù„Ø­Ø¸Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)
        function triggerBlock(reason) {
            // Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù…Ø³ØªØ±: Ù„Ø§ ØªØ­Ø¸Ø± Ø§Ù„Ø£Ø¯Ù…Ù† Ø£Ø¨Ø¯Ø§Ù‹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¬Ø±Ø¨Ø©
            if (userData && userData.role === 'admin') {
                console.warn("Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙƒØ´Ù Ù…Ø­Ø§ÙˆÙ„Ø©: " + reason);
                return;
            }

            db.ref('students/' + userPhone).update({
                status: 'blocked',
                blockReason: reason,
                blockDate: new Date().toLocaleString()
            }).then(() => {
                window.location.href = "contact.html";
            });
        }

        // ÙƒØ´Ù ØªØµÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©
        document.addEventListener('keyup', (e) => {
            if (e.key === 'PrintScreen' || e.keyCode === 44) triggerBlock("ØªØµÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©");
        });

        // ÙƒØ´Ù ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (DevTools)
        setInterval(() => {
            const isDev = window.outerWidth - window.innerWidth > 160 || window.outerHeight - window.innerHeight > 160;
            if (isDev) triggerBlock("Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ­Øµ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯");
        }, 2000);

        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
        setInterval(() => {
            const wm = document.getElementById('wm-text');
            wm.style.top = Math.random() * 75 + 5 + "%";
            wm.style.left = Math.random() * 60 + 5 + "%";
        }, 3000);

        // Ù…Ù†Ø¹ Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©
        document.onkeydown = function(e) {
            if (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'i')) {
                triggerBlock("Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©");
                return false;
            }
        };
    </script>
</body>
</html>
