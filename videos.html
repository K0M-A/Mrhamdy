<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨Ø© Ø®Ø¨ÙŠØ± Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ | Ù…Ø³ØªØ± Ø­Ù…Ø¯ÙŠ Ø¹ÙŠØ¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --primary: #00e5ff; --accent: #ff1744; --bg: #05080f; --card: #111827; --text: #e2e8f0; --gold: #ffd700; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 50px; overflow-x: hidden; }

        header { background: var(--card); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,229,255,0.1); sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary); text-shadow: 0 0 10px var(--primary); }

        /* Ù‚Ø³Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        #global-alert { background: rgba(255, 23, 68, 0.1); border: 1px dashed var(--accent); padding: 15px; margin: 20px 5%; border-radius: 12px; display: none; align-items: center; gap: 15px; animation: pulse 2s infinite; }

        .container { padding: 20px 5%; }
        .section-title { margin-bottom: 30px; border-right: 5px solid var(--primary); padding-right: 15px; }

        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .video-card { background: var(--card); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: 0.4s; position: relative; }
        .video-card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,229,255,0.1); }
        
        .thumbnail { width: 100%; height: 180px; background: #000; display: flex; align-items: center; justify-content: center; position: relative; }
        .thumbnail i { font-size: 4rem; color: rgba(255,255,255,0.2); }
        .play-btn { position: absolute; font-size: 3rem; color: var(--primary); cursor: pointer; opacity: 0.8; transition: 0.3s; }
        .play-btn:hover { opacity: 1; transform: scale(1.1); }

        .video-info { padding: 20px; }
        .video-info h3 { font-size: 1.1rem; margin-bottom: 10px; color: #fff; }
        .video-meta { display: flex; justify-content: space-between; font-size: 0.85rem; color: #94a3b8; }

        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        #player-modal { display: none; position: fixed; inset: 0; background: #000; z-index: 1000; padding: 20px; }
        .close-player { position: absolute; top: 20px; right: 20px; font-size: 2rem; color: #fff; cursor: pointer; z-index: 1100; }
        iframe { width: 100%; height: 100%; border-radius: 15px; }

        /* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
        #watermark { position: absolute; color: rgba(255,255,255,0.2); font-size: 1.2rem; font-weight: bold; pointer-events: none; z-index: 1050; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body oncontextmenu="return false;">

    <header>
        <div class="logo"><i class="fas fa-dna"></i> Ø®Ø¨ÙŠØ± Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</div>
        <div id="user-display" style="font-weight: bold; font-size: 0.9rem;"></div>
    </header>

    <div id="global-alert">
        <i class="fas fa-bullhorn" style="color: var(--accent); font-size: 1.5rem;"></i>
        <div>
            <strong style="color: var(--accent);">ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</strong>
            <span id="alert-text"></span>
        </div>
    </div>

    <div class="container">
        <div class="section-title">
            <h2>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ©</h2>
            <p style="color: #94a3b8;">Ø´Ø§Ù‡Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ Ø¨Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø© ÙˆØ¨Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ù…ØªØ·ÙˆØ±</p>
        </div>

        <div class="video-grid" id="videos-container">
            </div>
    </div>

    <div id="player-modal">
        <span class="close-player" onclick="closeVideo()">&times; Ø¥ØºÙ„Ø§Ù‚</span>
        <div id="watermark"></div>
        <iframe id="main-player" src="" frameborder="0" allowfullscreen allow="autoplay"></iframe>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCcFRLMsewcgYXYgVvdkyQHf-imoJHHzng",
            authDomain: "mrhamdy-1c406.firebaseapp.com",
            databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
            projectId: "mrhamdy-1c406",
            storageBucket: "mrhamdy-1c406.firebasestorage.app",
            messagingSenderId: "806268398144",
            appId: "1:806268398144:web:e7c9b87205cbb6fb2b4da5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const userPhone = localStorage.getItem('userLoggedIn');
        const userName = localStorage.getItem('userName');

        if(!userPhone) window.location.href = "go.html";
        document.getElementById('user-display').innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${userName}`;

        // 1. Ø¬Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        db.ref('admin/global_alert').on('value', snap => {
            const alertBox = document.getElementById('global-alert');
            const alertText = document.getElementById('alert-text');
            if(snap.exists()) {
                alertText.innerText = snap.val().text;
                alertBox.style.display = 'flex';
            } else {
                alertBox.style.display = 'none';
            }
        });

        // 2. Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('videos').on('value', snap => {
            const container = document.getElementById('videos-container');
            container.innerHTML = "";
            snap.forEach(child => {
                const vid = child.val();
                container.innerHTML += `
                    <div class="video-card animate__animated animate__fadeIn">
                        <div class="thumbnail">
                            <i class="fas fa-film"></i>
                            <i class="fas fa-play-circle play-btn" onclick="openVideo('${vid.url}', '${vid.title}')"></i>
                        </div>
                        <div class="video-info">
                            <h3>${vid.title}</h3>
                            <div class="video-meta">
                                <span><i class="fas fa-clock"></i> Ù…Ø­Ø§Ø¶Ø±Ø© Ù…Ø³Ø¬Ù„Ø©</span>
                                <span style="color: var(--primary)">Ù…Ø¬Ø§Ù†ÙŠ</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        });

        // 3. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø´ØºÙ„ ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
        let watermarkInterval;
        function openVideo(url, title) {
            const modal = document.getElementById('player-modal');
            const player = document.getElementById('main-player');
            const watermark = document.getElementById('watermark');
            
            player.src = url;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨)
            watermark.innerText = userPhone;
            watermarkInterval = setInterval(() => {
                watermark.style.top = Math.random() * 80 + "%";
                watermark.style.left = Math.random() * 80 + "%";
            }, 5000);

            // Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·
            db.ref('admin/activity_logs').push({
                userName, userPhone, 
                action: `Ø´Ø§Ù‡Ø¯ ÙÙŠØ¯ÙŠÙˆ: ${title}`,
                timestamp: Date.now()
            });
        }

        function closeVideo() {
            document.getElementById('player-modal').style.display = 'none';
            document.getElementById('main-player').src = "";
            document.body.style.overflow = 'auto';
            clearInterval(watermarkInterval);
        }

        // 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµØ§Ø±Ù…
        function banUser(reason) {
            db.ref('students/' + userPhone).update({ status: 'blocked' });
            db.ref('admin/activity_logs').push({
                userName, userPhone, action: `ğŸš« Ø­Ø¸Ø± Ø¢Ù„ÙŠ: ${reason}`, timestamp: Date.now()
            });
            alert("ØªÙ… Ø­Ø¸Ø±Ùƒ Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ©!");
            window.location.href = "contact.html";
        }

        // ÙƒØ´Ù Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ØºØ´
        document.addEventListener('keydown', e => {
            if (e.key === "PrintScreen") banUser("ØªØµÙˆÙŠØ± Ø´Ø§Ø´Ø©");
            if (e.ctrlKey && (e.key === "p" || e.key === "u" || e.key === "s")) {
                e.preventDefault();
                banUser("Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØµÙØ­");
            }
        });

        // Ù…Ù†Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø­Ø§Ù„ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && document.getElementById('player-modal').style.display === 'block') {
                closeVideo();
            }
        });

    </script>
</body>
</html>
