<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاستوديو المباشر | أ. حمدي</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header class="main-header">
        <div class="logo">BIO-<span class="neon-text">HAMDY</span></div>
        <div class="menu-wrapper" id="menuBtn">
            <div class="hamburger"></div>
        </div>
    </header>

    <nav class="side-nav" id="sideNav">
        <ul>
            <li><a href="index.html"><i class="fas fa-home"></i> الرئيسية</a></li>
            <li><a href="live.html" class="active"><i class="fas fa-video"></i> البث المباشر</a></li>
            <li><a href="exams.html"><i class="fas fa-microscope"></i> الامتحانات</a></li>
            <li><a href="anatomy.html"><i class="fas fa-dna"></i> معرض التشريح</a></li>
            <li><a href="library.html"><i class="fas fa-book"></i> المكتبة</a></li>
            <li><a href="videos.html"><i class="fas fa-play-circle"></i> الفيديوهات</a></li>
            <li><a href="contact.html"><i class="fas fa-paper-plane"></i> تواصل معنا</a></li>
        </ul>
    </nav>

    <main class="studio-hub">
        <div class="welcome-text">
            <h1>مرحباً بك في <span class="cyan-text">النظام الحيوي</span></h1>
            <p>اختر بيئة الشرح المناسبة للبدء</p>
        </div>

        <div class="main-options">
            <div class="opt-card green-glow" onclick="switchSystem('board')">
                <div class="icon-box"><i class="fas fa-chalkboard-teacher"></i></div>
                <h3>السبورة الذكية</h3>
                <p>بيئة كتابة تفاعلية متقدمة</p>
            </div>

            <div class="opt-card red-glow" onclick="switchSystem('files')">
                <div class="icon-box"><i class="fas fa-file-pdf"></i></div>
                <h3>عرض الملفات</h3>
                <p>رفع مذكرات PDF وصور توضيحية</p>
            </div>

            <div class="opt-card blue-glow" onclick="toggleChat()">
                <div class="icon-box"><i class="fas fa-comments"></i></div>
                <h3>قناة التواصل</h3>
                <p>نقاش فوري مع الطلاب</p>
            </div>
        </div>
    </main>

    <section class="workspace" id="workspace">
        <button class="back-btn" onclick="closeWorkspace()"><i class="fas fa-times"></i> إغلاق</button>
        
        <div id="board-system" class="sys-content">
            <div class="board-controls">
                <input type="color" id="colorPicker" value="#39ff14">
                <button onclick="setPenSize(5)">قلم رفيع</button>
                <button onclick="setPenSize(15)">قلم عريض</button>
                <button onclick="clearCanvas()" class="danger-btn">مسح الشاشة</button>
            </div>
            <canvas id="drawingCanvas"></canvas>
        </div>

        <div id="file-system" class="sys-content">
            <div class="upload-area" id="dropZone">
                <input type="file" id="fileInput" hidden accept=".pdf,image/*">
                <i class="fas fa-cloud-upload-alt"></i>
                <h2>اسحب الملف هنا أو انقر للرفع</h2>
            </div>
            <div id="previewArea"></div>
        </div>
    </section>

    <div class="chat-widget">
        <div class="chat-btn" id="chatToggleBtn">
            <i class="fas fa-comment-dots"></i>
            <span class="unread-dot" id="unreadBadge"></span>
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <span><i class="fas fa-circle"></i> البث المباشر</span>
                <button onclick="toggleChat()">×</button>
            </div>
            <div class="chat-messages" id="chatBox">
                <div class="message system">مرحباً بك يا مستر حمدي في الغرفة.</div>
            </div>
            <div class="chat-footer">
                <input type="text" id="msgInput" placeholder="اكتب رسالتك هنا...">
                <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
   <script type="module">
  // 1. استيراد المكتبات اللازمة (App + Database)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  // 2. إعدادات مشروعك
  const firebaseConfig = {
    apiKey: "AIzaSyCcFRLMsewcgYXYgVvdkyQHf-imoJHHzng",
    authDomain: "mrhamdy-1c406.firebaseapp.com",
    databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
    projectId: "mrhamdy-1c406",
    storageBucket: "mrhamdy-1c406.firebasestorage.app",
    messagingSenderId: "806268398144",
    appId: "1:806268398144:web:c40aef6b378377f72b4da5"
  };

  // 3. تشغيل فايربيز وقاعدة البيانات
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, "chat_messages");

  // --- منطق الشات ---

  const msgInput = document.getElementById("msgInput");
  const sendBtn = document.getElementById("sendBtn");
  const chatBox = document.getElementById("chatBox");

  // وظيفة إرسال الرسالة لفايربيز
  sendBtn.onclick = () => {
    const text = msgInput.value;
    if (text.trim() !== "") {
      push(messagesRef, {
        sender: "مستر حمدي", // هنا ممكن تغيرها بناءً على مين اللي داخل
        message: text,
        time: Date.now()
      });
      msgInput.value = "";
    }
  };

  // وظيفة استقبال الرسائل فوراً (Real-time)
  onChildAdded(messagesRef, (data) => {
    const msg = data.val();
    const msgDiv = document.createElement("div");
    msgDiv.classList.add("message");
    msgDiv.innerHTML = `<strong>${msg.sender}:</strong> ${msg.message}`;
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight; // النزول لآخر رسالة تلقائياً
  });

</script>
</body>

</html>

