<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±Ø© | Ù…Ø³ØªØ± Ø­Ù…Ø¯ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00bfa5; --accent: #ff1744; --bg: #0b111e; --card: #1e293b; --text: #ffffff; --gold: #ffd700; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding: 20px; }
        
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid var(--primary); text-align: center; width: 90%; max-width: 400px; }
        
        header { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.05); }
        
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .box { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); height: fit-content; }
        
        .msg-item, .log-item, .ban-item { background: #0f172a; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-right: 4px solid var(--accent); }
        .log-item { border-right-color: var(--primary); font-size: 0.85rem; }
        .ban-item { border-right-color: #ef4444; display: flex; justify-content: space-between; align-items: center; }
        
        input, textarea, select { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #334155; background: #0b111e; color: white; outline: none; font-size: 0.9rem; }
        input:focus, textarea:focus { border-color: var(--primary); }
        
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-p { background: var(--primary); color: white; }
        .btn-a { background: var(--accent); color: white; }
        .btn-g { background: #10b981; color: white; }
        .btn-back { background: #64748b; color: white; margin-bottom: 20px; width: auto; display: inline-flex; }
        .btn:hover { opacity: 0.8; transform: translateY(-2px); }
        
        .btn-unban { width: auto; padding: 5px 15px; font-size: 0.8rem; margin: 0; background: #10b981; }
        .btn-delete-all { background: transparent; color: #94a3b8; border: 1px solid #334155; font-size: 0.8rem; margin-top: 20px; }
        
        h2 { font-size: 1.2rem; margin-bottom: 15px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .q-box { border: 1px dashed #334155; padding: 10px; margin-top: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <i class="fas fa-user-shield" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h2>
            <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ">
            <button class="btn btn-p" onclick="login()">Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        </div>
    </div>

    <main id="admin-content" style="display:none;">
        <a href="index.html" class="btn btn-back"><i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        
        <header>
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ§¬ <small style="font-size: 0.9rem; opacity: 0.6;">Ù…Ø³ØªØ± Ø­Ù…Ø¯ÙŠ</small></h1>
            <div style="background: rgba(0, 191, 165, 0.1); padding: 8px 15px; border-radius: 10px; border: 1px solid var(--primary);">
                <i class="fas fa-users" style="color: var(--primary);"></i> Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¢Ù†: <span id="online-count" style="font-weight: 900;">0</span>
            </div>
        </header>

        <div class="admin-grid">
            
            <div class="box">
                <h2><i class="fas fa-user-slash"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</h2>
                <div id="banned-users-display" style="max-height: 300px; overflow-y: auto;">
                    <p style="text-align: center; opacity: 0.5;">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¸Ø±...</p>
                </div>
            </div>

            <div class="box">
                <h2><i class="fas fa-wallet"></i> Ø¥Ø¯Ø§Ø±Ø© Ø±ØµÙŠØ¯ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <input type="text" id="std-phone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨">
                <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ù…Ø«Ø§Ù„: 50 Ø£Ùˆ -50 Ù„Ù„Ø³Ø­Ø¨)">
                <button class="btn btn-g" onclick="updateBalance()">
                    <i class="fas fa-hand-holding-usd"></i> ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                </button>
            </div>

            <div class="box">
                <h2><i class="fas fa-file-signature"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
                <input type="text" id="exam-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                <div id="questions-container">
                    <div class="q-box">
                        <input type="text" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„" class="q-text">
                        <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 1 (Ø§Ù„ØµØ­ÙŠØ­Ø©)" class="q-correct">
                        <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 2" class="q-wrong">
                        <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 3" class="q-wrong">
                        <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 4" class="q-wrong">
                    </div>
                </div>
                <button class="btn btn-delete-all" onclick="addQuestionField()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø±</button>
                <button class="btn btn-p" onclick="saveExam()"><i class="fas fa-save"></i> Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
            </div>

            <div class="box">
                <h2><i class="fas fa-video"></i> Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
                <input type="text" id="vid-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
                <input type="text" id="vid-url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube/Drive/Direct)">
                <input type="number" id="vid-price" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© (0 Ù„Ù„Ù…Ø¬Ø§Ù†ÙŠ)">
                <button class="btn btn-p" onclick="uploadVideo()"><i class="fas fa-upload"></i> Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
            </div>

            <div class="box">
                <h2><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <div id="logs-display" style="max-height: 400px; overflow-y: auto;">
                    <p style="text-align: center; opacity: 0.5;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...</p>
                </div>
            </div>

            <div class="box">
                <h2><i class="fas fa-envelope"></i> Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <div id="msg-display" style="max-height: 400px; overflow-y: auto;">
                    <p style="text-align: center; opacity: 0.5;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹...</p>
                </div>
            </div>

            <div class="box">
                <h2><i class="fas fa-bullhorn"></i> Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±)</h2>
                <textarea id="notif-input" rows="3" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..."></textarea>
                <button class="btn btn-a" onclick="sendNotif()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¬Ù…ÙŠØ¹</button>
                <button class="btn btn-delete-all" onclick="clearNotifs()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>

                <hr style="margin:20px 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">
                
                <h2><i class="fas fa-image"></i> ØªØºÙŠÙŠØ± Ø¨ÙˆØ³ØªØ± Ø§Ù„ØµÙØ­Ø©</h2>
                <input type="text" id="p-url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±">
                <button class="btn btn-p" onclick="updatePoster()">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©</button>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCcFRLMsewcgYXYgVvdkyQHf-imoJHHzng",
            authDomain: "mrhamdy-1c406.firebaseapp.com",
            databaseURL: "https://mrhamdy-1c406-default-rtdb.firebaseio.com",
            projectId: "mrhamdy-1c406",
            storageBucket: "mrhamdy-1c406.firebasestorage.app",
            messagingSenderId: "806268398144",
            appId: "1:806268398144:web:e7c9b87205cbb6fb2b4da5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function login() {
            if(document.getElementById('pass').value === 'hamdyhamdy012345') {
                document.getElementById('login-overlay').style.display='none';
                document.getElementById('admin-content').style.display='block';
                loadAdmin();
                loadLogs();
                loadBannedUsers();
            } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø© ÙŠØ§ Ù…Ø³ØªØ±!"); }
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† (Ø¬Ø¯ÙŠØ¯) ---
        function loadBannedUsers() {
            db.ref('users').orderByChild('status').equalTo('banned').on('value', s => {
                const display = document.getElementById('banned-users-display');
                display.innerHTML = "";
                if(s.exists()){
                    s.forEach(child => {
                        const u = child.val();
                        display.innerHTML += `
                            <div class="ban-item">
                                <div>
                                    <strong>${u.name}</strong><br>
                                    <small>${u.phone}</small><br>
                                    <span style="color:#ef4444; font-size:0.7rem;">Ø§Ù„Ø³Ø¨Ø¨: ${u.banReason || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                                <button class="btn btn-unban" onclick="unbanUser('${child.key}', '${u.name}')">ÙÙƒ Ø§Ù„Ø­Ø¸Ø±</button>
                            </div>`;
                    });
                } else {
                    display.innerHTML = '<p style="text-align: center; opacity: 0.5;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                }
            });
        }

        function unbanUser(key, name) {
            if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù† ${name}ØŸ`)) {
                db.ref('users/' + key).update({
                    status: 'active',
                    banReason: null
                }).then(() => {
                    alert("ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­");
                });
            }
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±ØµÙŠØ¯ ---
        function updateBalance() {
            const phone = document.getElementById('std-phone').value;
            const amt = parseFloat(document.getElementById('amount').value);
            if(!phone || !amt) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");

            const ref = db.ref('users').orderByChild('phone').equalTo(phone);
            ref.once('value', snapshot => {
                if(snapshot.exists()) {
                    const key = Object.keys(snapshot.val())[0];
                    const currentBal = snapshot.val()[key].balance || 0;
                    db.ref('users/'+key+'/balance').set(currentBal + amt);
                    logAction(snapshot.val()[key].name, phone, `ØªÙ… ${amt > 0 ? 'Ø´Ø­Ù†' : 'Ø³Ø­Ø¨'} Ø±ØµÙŠØ¯ Ø¨Ù‚ÙŠÙ…Ø© ${Math.abs(amt)} Ø¬.Ù…`);
                    alert("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­");
                } else { alert("Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„!"); }
            });
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ---
        function addQuestionField() {
            const container = document.getElementById('questions-container');
            const div = document.createElement('div');
            div.className = 'q-box';
            div.innerHTML = `
                <input type="text" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„" class="q-text">
                <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 1 (Ø§Ù„ØµØ­ÙŠØ­Ø©)" class="q-correct">
                <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 2" class="q-wrong">
                <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 3" class="q-wrong">
                <input type="text" placeholder="Ø¥Ø¬Ø§Ø¨Ø© 4" class="q-wrong">
            `;
            container.appendChild(div);
        }

        function saveExam() {
            const title = document.getElementById('exam-title').value;
            const qBoxes = document.querySelectorAll('.q-box');
            let questions = [];

            qBoxes.forEach(box => {
                questions.push({
                    q: box.querySelector('.q-text').value,
                    correct: box.querySelector('.q-correct').value,
                    options: [
                        box.querySelector('.q-correct').value,
                        ...Array.from(box.querySelectorAll('.q-wrong')).map(i => i.value)
                    ].sort(() => Math.random() - 0.5)
                });
            });

            if(title && questions.length > 0) {
                db.ref('exams').push({ title, questions, date: Date.now() });
                alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­");
            }
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ---
        function uploadVideo() {
            const title = document.getElementById('vid-title').value;
            const url = document.getElementById('vid-url').value;
            const price = document.getElementById('vid-price').value || 0;
            if(title && url) {
                db.ref('videos').push({ title, url, price: parseInt(price), date: Date.now() });
                alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…ÙƒØªØ¨Ø©");
            }
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¬Ù„Ø§Øª ---
        function logAction(name, phone, action) {
            db.ref('admin/logs').push({
                name, phone, action, time: new Date().toLocaleString('ar-EG')
            });
        }

        function loadLogs() {
            db.ref('admin/logs').limitToLast(50).on('value', s => {
                const display = document.getElementById('logs-display');
                display.innerHTML = "";
                if(s.exists()) {
                    Object.values(s.val()).reverse().forEach(log => {
                        display.innerHTML += `
                            <div class="log-item">
                                <strong>${log.name} (${log.phone})</strong><br>
                                <span>${log.action}</span>
                                <small style="display:block; opacity:0.5">${log.time}</small>
                            </div>`;
                    });
                }
            });
        }

        // --- Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠØ© ---
        function loadAdmin() {
            db.ref('admin/online_users').on('value', s => {
                document.getElementById('online-count').innerText = s.numChildren() || 0;
            });
            db.ref('admin/messages').on('value', s => {
                const display = document.getElementById('msg-display');
                display.innerHTML = "";
                const data = s.val();
                if(data) {
                    Object.keys(data).reverse().forEach(key => {
                        const m = data[key];
                        display.innerHTML += `
                            <div class="msg-item">
                                <strong>${m.sender}</strong> <small style="float:left; opacity:0.5">${m.time}</small>
                                <p style="margin:10px 0; color: #cbd5e1;">${m.message}</p>
                                <input type="text" id="rep-${key}" placeholder="Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨...">
                                <button class="btn btn-p" style="padding: 5px; font-size: 0.8rem;" onclick="reply('${key}')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
                                <button onclick="del('${key}')" style="background:none; border:none; color:var(--accent); cursor:pointer; margin-top:10px; font-size:0.8rem; display:block;">Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© <i class="fas fa-trash"></i></button>
                            </div>`;
                    });
                }
            });
        }

        function reply(id) {
            const txt = document.getElementById('rep-'+id).value;
            if(txt) {
                db.ref('admin/replies/'+id).set({ text: txt, time: new Date().toLocaleString('ar-EG') }).then(() => {
                    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯");
                    document.getElementById('rep-'+id).value = "";
                });
            }
        }

        function del(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) { db.ref('admin/messages/'+id).remove(); } }

        function sendNotif() {
            const t = document.getElementById('notif-input').value;
            if(t) { db.ref('admin/notifications').push({ text: t, time: Date.now() }).then(() => alert("ØªÙ… Ø§Ù„Ø¨Ø«!")); }
        }

        function clearNotifs() { if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ")) db.ref('admin/notifications').remove(); }

        function updatePoster() {
            const u = document.getElementById('p-url').value;
            if(u) db.ref('admin/poster_url').set(u).then(() => alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"));
        }
    </script>
</body>
</html>
